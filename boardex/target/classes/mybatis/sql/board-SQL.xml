<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="boardDAO">

<!-- 검색조건 sql -->

<sql id="pagination">
	 <if test="searchKeyword != null and searchKeyword != ''">
		 	<choose>
		 		<when test="searchType != null and searchType != ''">
		 			<if test="searchType == 'title'">
		 			AND title LIKE CONCAT('%', #{searchKeyword}, '%')
		 			</if>
		 			<if test="searchType == 'content'">
		 			AND content LIKE CONCAT('%', #{searchKeyword}, '%')
		 			</if>
		 		</when>
		 		<otherwise>
		 			AND ( title LIKE CONCAT('%', #{searchKeyword}, '%')
		 				OR
		 				  content LIKE CONCAT('%', #{searchKeyword}, '%')
		 				)
		 		</otherwise>
		 	</choose>
		 </if>
</sql>



<!-- 전체 조회 -->
<select id="findAllBoards" resultType="BoardVO">
	SELECT idx
		 , writer
		 , title
		 , create_date
		 , hit
	FROM board
		<where>
			<include refid="pagination"></include> 
		</where>
	
	ORDER BY idx DESC
	LIMIT #{perPage} OFFSET #{startPage}
</select>

<select id="getBoard" resultType="BoardVO">
	SELECT title
		 , writer
		 , create_date
		 , hit
		 , content
	FROM board
	WHERE idx = #{idx}

</select>

<delete id="delBoard" parameterType="BoardVO">
	DELETE 
	FROM board
	WHERE idx = #{idx}
</delete>

<select id="getMaxIdx" resultType="int">
	SELECT
	MAX(idx)
	FROM board
</select>

<insert id="upsert" parameterType="BoardVO">
INSERT INTO board (
	idx
	,writer
	,title
	,content
	,create_date
	,hit
	) VALUES (
		#{idx}
		,#{writer}
		,#{title}
		,#{content}
		,NOW()
		,default

) ON DUPLICATE KEY
UPDATE
	title = #{title}
	,content = #{content}
	,writer = #{writer}
</insert>


<!-- 테이블 목록 갯수 조회 -->
<select id="getBoardsCnt" resultType="int">
	SELECT COUNT(idx)
	FROM board
		<where>
			<include refid="pagination"></include>
		</where>
</select>

</mapper>